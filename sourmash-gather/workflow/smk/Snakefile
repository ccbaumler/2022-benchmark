#run in sourmash-gather directory

#SAMPLES, =glob_wildcards("input/hu/{sample}.abundtrim.fq.gz.sig")
#print(f"samples are:{SAMPLES}")
SAMPLES = ["SRR1976948", "SRR1977296","SRR1977357","SRR1977249","SRR1977304","SRR1977365"]
#SAMPLES = ['SRR1976948']

output_dir = '../../output/smk_out/'
input_dir =  '../../input/hu/'
database = '/group/ctbrowngrp/sourmash-db/gtdb-rs207/gtdb-rs207.genomic-reps.dna.k31.zip'
rule all:
    input:
        expand(output_dir+"gather/{sample}.csv", sample=SAMPLES),
        expand(output_dir+"flame/{sample}.svg", sample=SAMPLES),
rule benchmark:
    input:
        input_dir+"{sample}.abundtrim.fq.gz.sig"
    output:
        output_dir+"gather/{sample}.csv"
    benchmark:
        repeat(output_dir+"bench/{sample}.tsv",3)
    shell:
        "sourmash gather {input} /group/ctbrowngrp/sourmash-db/gtdb-rs207/gtdb-rs207.genomic-reps.dna.k31.zip -o {output}"

rule profiler:
    input:
        input_dir+"{sample}.abundtrim.fq.gz.sig"
    output:
        output_dir+"flame/{sample}.svg"
    shell:
        "py-spy record --native -o {output} -- sourmash gather {input} /group/ctbrowngrp/sourmash-db/gtdb-rs207/gtdb-rs207.genomic-reps.dna.k31.zip -o "+output_dir+"flame/csv/{wildcards.sample}.csv "


    