#SAMPLES = ["SRR1976948", "SRR1977296","SRR1977357","SRR1977249","SRR1977304","SRR1977365"]
SAMPLES = ["SRR1976948"]
output_dir = '../../output/smk_out/'
input_dir =  '../../input/hu/'
database = '/group/ctbrowngrp/sourmash-db/gtdb-rs207/gtdb-rs207.genomic-reps.dna.k31.zip'

# Rule to generate gather output for benchmark trial 1
rule benchmark_trial1:
    input:
        input_dir+"{sample}.abundtrim.fq.gz.sig"
    output:
        output_dir+"gather/{sample}_trial1.csv"
    shell:
        "sourmash gather {input} {database} -o {output}"

# Rule to generate gather output for benchmark trial 2
rule benchmark_trial2:
    input:
        input_dir+"{sample}.abundtrim.fq.gz.sig"
    output:
        output_dir+"gather/{sample}_trial2.csv"
    shell:
        "sourmash gather {input} {database} -o {output}"

# Rule to generate gather output for benchmark trial 3
rule benchmark_trial3:
    input:
        input_dir+"{sample}.abundtrim.fq.gz.sig"
    output:
        output_dir+"gather/{sample}_trial3.csv"
    shell:
        "sourmash gather {input} {database} -o {output}"

# Rule to generate profiler output
rule profiler:
    input:
        input_dir+"{sample}.abundtrim.fq.gz.sig"
    output:
        output_dir+"flame/{sample}.svg"
    shell:
        "py-spy record --native -o {output} -- sourmash gather {input} {database} -o "+output_dir+"flame/csv/{wildcards.sample}.csv "

# Rule all to specify all the output files to be generated
rule all:
    input:
        expand(output_dir+"gather/{sample}_trial{trial}.csv", sample=SAMPLES, trial=[1, 2, 3]),
        expand(output_dir+"flame/{sample}.svg", sample=SAMPLES)

